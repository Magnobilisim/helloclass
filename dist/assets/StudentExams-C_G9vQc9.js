import{c as F,u as ae,d as re,r as i,U,j as e}from"./index-C5K4Kfcd.js";import{u as ne}from"./useAdTracking-Bm9s57CS.js";import{S as ie}from"./search-i4_H52qF.js";import{G as oe}from"./graduation-cap-DIr2QCWg.js";import{B as ce}from"./bot-CPX00xs-.js";import{C as de}from"./circle-check-big-DEjO4KOF.js";import{C as xe}from"./clock-CbF8bx74.js";import{E as me}from"./eye-DYEtmAhx.js";import{P as pe}from"./play-FpYKxq5-.js";import{S as he}from"./shopping-cart-CNod2Q2i.js";import{X as ge}from"./x-DstQxW1F.js";import"./adTrackingService-DSpkMtQT.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],ue=F("book",be);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],B=F("funnel",fe),ze=()=>{const{exams:n,user:l,purchaseExam:j,approvedTopics:v,availableSubjects:g,t:a,results:b,watchAdForPoints:H,manualAds:$}=ae(),T=re(),[N,R]=i.useState(""),[c,w]=i.useState("All"),[o,u]=i.useState("All"),[A,S]=i.useState("All"),[p,G]=i.useState("All"),[f,k]=i.useState(null),[C,E]=i.useState(null),[D,y]=i.useState(!1),[q,O]=i.useState("");i.useEffect(()=>{l!=null&&l.classLevel&&w(l.classLevel)},[l]);const Q=g.filter(t=>c==="All"||t.id==="sub-eng"?!0:t.grades.includes(c)),V=(l==null?void 0:l.role)===U.STUDENT,W=(l==null?void 0:l.role)===U.TEACHER?"/teacher":"/student",X=V?"/student/shop":"/teacher/shop",Y=l==null?void 0:l.schoolId,_=n.filter(t=>t.isPublished).filter(t=>{const s=t.title.toLowerCase().includes(N.toLowerCase())||t.creatorName.toLowerCase().includes(N.toLowerCase()),x=c==="All"||t.classLevel===c,r=o==="All"||t.subjectId===o,d=A==="All"||t.topic===A;let m=!0;return o==="sub-eng"&&p!=="All"&&(m=t.englishLevel===p),s&&x&&r&&d&&m}),J=o!=="All"?(v[o]||[]).filter(t=>o==="sub-eng"?p==="All"||t.level===p:c==="All"||t.grade===c):[],K=i.useMemo(()=>l?new Set(b.filter(t=>t.studentId===l.id).map(t=>t.examId)):new Set,[b,l]),h=i.useMemo(()=>$.filter(t=>t.isActive&&(t.placement==="exam"||t.placement==="both")),[$]),Z=i.useMemo(()=>{if(h.length===0)return _.map(r=>({type:"exam",exam:r}));const t=[];let s=0;const x=4;if(_.forEach((r,d)=>{if(d>0&&d%x===0){const m=h[s%h.length];t.push({type:"ad",ad:m,key:`exam-feed-ad-${d}-${m.id}-${s}`}),s+=1}t.push({type:"exam",exam:r})}),!t.some(r=>r.type==="ad")){const r=h[0];t.splice(Math.min(1,t.length),0,{type:"ad",ad:r,key:`exam-feed-ad-fallback-${r.id}`})}return t},[_,h]),L=t=>{T(`${W}/exam/${t}`)},z=(t,s)=>{var r;if(!((r=l==null?void 0:l.purchasedExamIds)==null?void 0:r.includes(t))&&s>0){if(((l==null?void 0:l.points)||0)<s){O(a("insufficient_points_message").replace("{points}",`${s}`)),y(!0);return}j(t)&&M(t)}else M(t)},ee=t=>{sessionStorage.removeItem(`exam_time_${t}`),L(t)},M=t=>{const s=n.find(r=>r.id===t);if(!s)return;if(!(s.timeLimit<=0)){sessionStorage.removeItem(`exam_time_${t}`),L(t);return}E(s.timeLimit||15),k(t)},te=()=>{f&&C&&(sessionStorage.setItem(`exam_time_${f}`,C.toString()),L(f),k(null),E(null))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-6 bg-white p-6 rounded-3xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-3 text-gray-500",size:20}),e.jsx("input",{type:"text",placeholder:a("search_placeholder"),value:N,onChange:t=>R(t.target.value),className:"w-full pl-10 pr-4 py-3 rounded-2xl border border-gray-200 bg-gray-50 focus:bg-white focus:border-brand-500 text-gray-900"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(oe,{size:18,className:"text-brand-500"}),e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:a("grade")})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 custom-scrollbar",children:[e.jsx("button",{onClick:()=>{w("All"),u("All")},className:`w-12 h-12 flex-shrink-0 rounded-2xl text-sm font-bold border-2 flex items-center justify-center ${c==="All"?"bg-gray-900 text-white":"bg-white text-gray-400"}`,children:a("all")}),Array.from({length:12},(t,s)=>s+1).map(t=>e.jsx("button",{onClick:()=>{w(t),u("All")},className:`w-12 h-12 flex-shrink-0 rounded-2xl text-lg font-bold border-2 flex items-center justify-center ${c===t?"bg-brand-500 text-white border-brand-500":"bg-white text-gray-600"}`,children:t},t))]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ue,{size:18,className:"text-blue-500"}),e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:a("subject")})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 custom-scrollbar",children:[e.jsx("button",{onClick:()=>{u("All"),S("All")},className:`px-5 py-2.5 rounded-xl text-sm font-bold whitespace-nowrap border ${o==="All"?"bg-gray-900 text-white":"bg-white text-gray-600"}`,children:a("all")}),Q.map(t=>e.jsx("button",{onClick:()=>{u(t.id),S("All")},className:`px-5 py-2.5 rounded-xl text-sm font-bold whitespace-nowrap border ${o===t.id?"bg-blue-500 text-white border-blue-500":"bg-white text-gray-600"}`,children:t.name},t.id))]})]}),o==="sub-eng"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-2 border-t border-gray-50 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{size:16,className:"text-gray-400"}),e.jsxs("span",{className:"text-xs font-bold text-gray-400 uppercase",children:[a("level"),":"]})]}),e.jsxs("select",{value:p,onChange:t=>G(t.target.value),className:"bg-gray-50 border border-gray-200 text-gray-900 rounded-xl px-4 py-2 text-sm font-bold outline-none",children:[e.jsx("option",{value:"All",children:a("all")}),["A1","A2","B1","B2","C1","C2"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),o!=="All"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-2 border-t border-gray-50 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{size:16,className:"text-gray-400"}),e.jsxs("span",{className:"text-xs font-bold text-gray-400 uppercase",children:[a("topic"),":"]})]}),e.jsxs("select",{value:A,onChange:t=>S(t.target.value),className:"bg-gray-50 border border-gray-200 text-gray-900 rounded-xl px-4 py-2 text-sm font-bold outline-none",children:[e.jsxs("option",{value:"All",children:[a("all")," ",a("topic")]}),J.map((t,s)=>e.jsx("option",{value:t.name,children:t.name},s))]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pb-16 md:pb-0",children:Z.map(t=>{var I,P;if(t.type==="ad")return e.jsx(ye,{ad:t.ad,label:a("ads"),userId:l==null?void 0:l.id,userRole:l==null?void 0:l.role,locationHint:Y},t.key);const s=t.exam,x=(I=l==null?void 0:l.purchasedExamIds)==null?void 0:I.includes(s.id),r=K.has(s.id),d=s.price===0,m=((l==null?void 0:l.points)||0)>=s.price,se=((P=g.find(le=>le.id===s.subjectId))==null?void 0:P.name)||"Unknown";return e.jsxs("div",{className:"bg-white p-5 rounded-3xl shadow-sm border border-gray-100 flex flex-col relative overflow-hidden group hover:-translate-y-1 transition-transform",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4 relative z-10",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.difficulty==="Easy"?"bg-green-100 text-green-600":s.difficulty==="Medium"?"bg-yellow-100 text-yellow-600":"bg-red-100 text-red-600"}`,children:a(s.difficulty.toLowerCase())}),s.isAI&&e.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-bold bg-indigo-100 text-indigo-600 flex items-center gap-1",children:[e.jsx(ce,{size:12})," AI"]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("span",{className:"text-xs text-gray-500 font-bold bg-gray-50 px-2 py-1 rounded-lg border border-gray-100",children:se}),(s.classLevel||s.englishLevel)&&e.jsx("span",{className:"text-[10px] text-white font-bold bg-brand-400 px-2 py-0.5 rounded-lg",children:s.englishLevel||`${s.classLevel}. ${a("grade")}`}),r&&e.jsxs("span",{className:"px-2 py-0.5 rounded-full text-[10px] font-bold bg-emerald-50 text-emerald-600 flex items-center gap-1",children:[e.jsx(de,{size:10})," ",a("solved")]})]})]}),e.jsx("h4",{className:"font-bold text-lg text-gray-800 mb-1 line-clamp-2",children:s.title}),e.jsxs("p",{className:"text-xs text-gray-500 mb-4",children:[a("by")," ",s.creatorName]}),e.jsxs("div",{className:"mt-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 font-medium",children:[e.jsx(xe,{size:14})," ",s.timeLimit,a("min")]}),x||d?e.jsx("button",{onClick:()=>r?ee(s.id):z(s.id,s.price),className:`px-4 py-2 rounded-xl text-sm font-bold flex items-center gap-2 ${r?"bg-gray-900 text-white hover:bg-gray-800":"bg-blue-50 text-blue-600 hover:bg-blue-100"}`,children:r?e.jsxs(e.Fragment,{children:[e.jsx(me,{size:16})," ",a("view_details")]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:16})," ",a("start")]})}):e.jsxs("button",{onClick:()=>z(s.id,s.price),className:`px-4 py-2 rounded-xl text-sm font-bold flex items-center gap-2 ${m?"bg-brand-500 text-white shadow-lg hover:bg-brand-600":"bg-gray-200 text-gray-400"}`,children:[e.jsx(he,{size:16})," ",s.price," ",a("points")]})]})]},s.id)})}),f&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white p-6 rounded-3xl w-full max-w-sm shadow-2xl relative animate-fade-in",children:[e.jsx("button",{onClick:()=>k(null),className:"absolute top-4 right-4 text-gray-400",children:e.jsx(ge,{size:24})}),e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:[a("start")," Exam"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a("time_min")}),e.jsx("input",{type:"number",value:C,onChange:t=>E(Math.max(1,parseInt(t.target.value))),className:"w-full bg-gray-50 rounded-xl p-4 text-center text-2xl text-gray-900 font-bold outline-none"})]}),e.jsxs("button",{onClick:te,className:"w-full py-4 rounded-xl bg-brand-500 text-white font-bold text-lg shadow-lg",children:[a("start")," ðŸš€"]})]})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-sm w-full space-y-4 shadow-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:a("insufficient_points_title")}),e.jsx("p",{className:"text-gray-600",children:q}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{H(),y(!1)},className:"w-full bg-brand-100 text-brand-700 font-semibold rounded-xl py-3 hover:bg-brand-200 transition-colors",children:a("watch_ad_cta")}),e.jsx("button",{onClick:()=>{y(!1),T(X)},className:"w-full bg-gray-900 text-white font-semibold rounded-xl py-3 hover:scale-[1.02] transition-transform",children:a("go_to_shop_cta")}),e.jsx("button",{onClick:()=>y(!1),className:"w-full border border-gray-200 text-gray-600 font-semibold rounded-xl py-3 hover:bg-gray-50 transition-colors",children:a("close")})]})]})})]})},ye=({ad:n,label:l,userId:j,userRole:v,locationHint:g})=>{const{adRef:a,logAdClick:b}=ne({adId:n.id,placement:n.placement,context:"exam",userId:j,userRole:v,locationHint:g});return e.jsxs("div",{ref:a,className:"bg-gradient-to-br from-gray-900 to-gray-800 text-white p-5 rounded-3xl shadow-lg border border-gray-800 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-gray-300",children:l}),n.highlightLabel&&e.jsx("span",{className:"text-[10px] font-black text-amber-300 uppercase",children:n.highlightLabel})]}),e.jsx("h4",{className:"text-xl font-black leading-tight",children:n.title}),n.description&&e.jsx("p",{className:"text-sm text-gray-300",children:n.description}),n.imageUrl&&e.jsx("div",{className:"rounded-2xl overflow-hidden border border-white/10 mt-2",children:e.jsx("img",{src:n.imageUrl,className:"w-full h-40 object-cover"})}),n.ctaText&&n.ctaUrl&&e.jsx("a",{href:n.ctaUrl,target:"_blank",rel:"noreferrer",onClick:b,className:"mt-auto inline-flex items-center justify-center px-4 py-2 rounded-xl bg-white text-gray-900 font-bold text-sm hover:opacity-90 transition-opacity",children:n.ctaText})]})};export{ze as StudentExams};
