import{c as Ce,f as Je,d as Ze,u as He,U as Ae,r as y,j as r,M as Ve,g as Ge}from"./index-C5K4Kfcd.js";import{C as $e}from"./circle-alert-BDjHTnAJ.js";import{L as Qe}from"./loader-circle-DJ3ru9dI.js";import{B as qe}from"./bot-CPX00xs-.js";import{T as Xe}from"./timer-d_5kPc6l.js";import{Z as Ye}from"./zap-BsO_zEPX.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],tt=Ce("chevron-left",et);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],st=Ce("chevron-right",rt);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],nt=Ce("flag",at);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M10.029 4.285A2 2 0 0 0 7 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"1ystz2"}],["path",{d:"M3 4v16",key:"1ph11n"}]],Te=Ce("step-forward",ot);var Fe={};(function $(k,Z,o,ae){var z=!!(k.Worker&&k.Blob&&k.Promise&&k.OffscreenCanvas&&k.OffscreenCanvasRenderingContext2D&&k.HTMLCanvasElement&&k.HTMLCanvasElement.prototype.transferControlToOffscreen&&k.URL&&k.URL.createObjectURL),a=typeof Path2D=="function"&&typeof DOMMatrix=="function",de=(function(){if(!k.OffscreenCanvas)return!1;try{var t=new OffscreenCanvas(1,1),e=t.getContext("2d");e.fillRect(0,0,1,1);var n=t.transferToImageBitmap();e.createPattern(n,"no-repeat")}catch{return!1}return!0})();function ne(){}function ee(t){var e=Z.exports.Promise,n=e!==void 0?e:k.Promise;return typeof n=="function"?new n(t):(t(ne,ne),null)}var te=(function(t,e){return{transform:function(n){if(t)return n;if(e.has(n))return e.get(n);var d=new OffscreenCanvas(n.width,n.height),u=d.getContext("2d");return u.drawImage(n,0,0),e.set(n,d),d},clear:function(){e.clear()}}})(de,new Map),ue=(function(){var t=Math.floor(16.666666666666668),e,n,d={},u=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(e=function(m){var h=Math.random();return d[h]=requestAnimationFrame(function c(x){u===x||u+t-1<x?(u=x,delete d[h],m()):d[h]=requestAnimationFrame(c)}),h},n=function(m){d[m]&&cancelAnimationFrame(d[m])}):(e=function(m){return setTimeout(m,t)},n=function(m){return clearTimeout(m)}),{frame:e,cancel:n}})(),we=(function(){var t,e,n={};function d(u){function m(h,c){u.postMessage({options:h||{},callback:c})}u.init=function(c){var x=c.transferControlToOffscreen();u.postMessage({canvas:x},[x])},u.fire=function(c,x,p){if(e)return m(c,null),e;var M=Math.random().toString(36).slice(2);return e=ee(function(v){function _(E){E.data.callback===M&&(delete n[M],u.removeEventListener("message",_),e=null,te.clear(),p(),v())}u.addEventListener("message",_),m(c,M),n[M]=_.bind(null,{data:{callback:M}})}),e},u.reset=function(){u.postMessage({reset:!0});for(var c in n)n[c](),delete n[c]}}return function(){if(t)return t;if(!o&&z){var u=["var CONFETTI, SIZE = {}, module = {};","("+$.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{t=new Worker(URL.createObjectURL(new Blob([u])))}catch(m){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",m),null}d(t)}return t}})(),oe={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function je(t,e){return e?e(t):t}function W(t){return t!=null}function N(t,e,n){return je(t&&W(t[e])?t[e]:oe[e],n)}function i(t){return t<0?0:Math.floor(t)}function me(t,e){return Math.floor(Math.random()*(e-t))+t}function S(t){return parseInt(t,16)}function re(t){return t.map(Oe)}function Oe(t){var e=String(t).replace(/[^0-9a-f]/gi,"");return e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),{r:S(e.substring(0,2)),g:S(e.substring(2,4)),b:S(e.substring(4,6))}}function xe(t){var e=N(t,"origin",Object);return e.x=N(e,"x",Number),e.y=N(e,"y",Number),e}function D(t){t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight}function H(t){var e=t.getBoundingClientRect();t.width=e.width,t.height=e.height}function P(t){var e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=t,e}function se(t,e,n,d,u,m,h,c,x){t.save(),t.translate(e,n),t.rotate(m),t.scale(d,u),t.arc(0,0,1,h,c,x),t.restore()}function he(t){var e=t.angle*(Math.PI/180),n=t.spread*(Math.PI/180);return{x:t.x,y:t.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:t.startVelocity*.5+Math.random()*t.startVelocity,angle2D:-e+(.5*n-Math.random()*n),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:t.color,shape:t.shape,tick:0,totalTicks:t.ticks,decay:t.decay,drift:t.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:t.gravity*3,ovalScalar:.6,scalar:t.scalar,flat:t.flat}}function Y(t,e){e.x+=Math.cos(e.angle2D)*e.velocity+e.drift,e.y+=Math.sin(e.angle2D)*e.velocity+e.gravity,e.velocity*=e.decay,e.flat?(e.wobble=0,e.wobbleX=e.x+10*e.scalar,e.wobbleY=e.y+10*e.scalar,e.tiltSin=0,e.tiltCos=0,e.random=1):(e.wobble+=e.wobbleSpeed,e.wobbleX=e.x+10*e.scalar*Math.cos(e.wobble),e.wobbleY=e.y+10*e.scalar*Math.sin(e.wobble),e.tiltAngle+=.1,e.tiltSin=Math.sin(e.tiltAngle),e.tiltCos=Math.cos(e.tiltAngle),e.random=Math.random()+2);var n=e.tick++/e.totalTicks,d=e.x+e.random*e.tiltCos,u=e.y+e.random*e.tiltSin,m=e.wobbleX+e.random*e.tiltCos,h=e.wobbleY+e.random*e.tiltSin;if(t.fillStyle="rgba("+e.color.r+", "+e.color.g+", "+e.color.b+", "+(1-n)+")",t.beginPath(),a&&e.shape.type==="path"&&typeof e.shape.path=="string"&&Array.isArray(e.shape.matrix))t.fill(Ee(e.shape.path,e.shape.matrix,e.x,e.y,Math.abs(m-d)*.1,Math.abs(h-u)*.1,Math.PI/10*e.wobble));else if(e.shape.type==="bitmap"){var c=Math.PI/10*e.wobble,x=Math.abs(m-d)*.1,p=Math.abs(h-u)*.1,M=e.shape.bitmap.width*e.scalar,v=e.shape.bitmap.height*e.scalar,_=new DOMMatrix([Math.cos(c)*x,Math.sin(c)*x,-Math.sin(c)*p,Math.cos(c)*p,e.x,e.y]);_.multiplySelf(new DOMMatrix(e.shape.matrix));var E=t.createPattern(te.transform(e.shape.bitmap),"no-repeat");E.setTransform(_),t.globalAlpha=1-n,t.fillStyle=E,t.fillRect(e.x-M/2,e.y-v/2,M,v),t.globalAlpha=1}else if(e.shape==="circle")t.ellipse?t.ellipse(e.x,e.y,Math.abs(m-d)*e.ovalScalar,Math.abs(h-u)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI):se(t,e.x,e.y,Math.abs(m-d)*e.ovalScalar,Math.abs(h-u)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI);else if(e.shape==="star")for(var f=Math.PI/2*3,A=4*e.scalar,O=8*e.scalar,T=e.x,q=e.y,U=5,F=Math.PI/U;U--;)T=e.x+Math.cos(f)*O,q=e.y+Math.sin(f)*O,t.lineTo(T,q),f+=F,T=e.x+Math.cos(f)*A,q=e.y+Math.sin(f)*A,t.lineTo(T,q),f+=F;else t.moveTo(Math.floor(e.x),Math.floor(e.y)),t.lineTo(Math.floor(e.wobbleX),Math.floor(u)),t.lineTo(Math.floor(m),Math.floor(h)),t.lineTo(Math.floor(d),Math.floor(e.wobbleY));return t.closePath(),t.fill(),e.tick<e.totalTicks}function B(t,e,n,d,u){var m=e.slice(),h=t.getContext("2d"),c,x,p=ee(function(M){function v(){c=x=null,h.clearRect(0,0,d.width,d.height),te.clear(),u(),M()}function _(){o&&!(d.width===ae.width&&d.height===ae.height)&&(d.width=t.width=ae.width,d.height=t.height=ae.height),!d.width&&!d.height&&(n(t),d.width=t.width,d.height=t.height),h.clearRect(0,0,d.width,d.height),m=m.filter(function(E){return Y(h,E)}),m.length?c=ue.frame(_):v()}c=ue.frame(_),x=v});return{addFettis:function(M){return m=m.concat(M),p},canvas:t,promise:p,reset:function(){c&&ue.cancel(c),x&&x()}}}function J(t,e){var n=!t,d=!!N(e||{},"resize"),u=!1,m=N(e,"disableForReducedMotion",Boolean),h=z&&!!N(e||{},"useWorker"),c=h?we():null,x=n?D:H,p=t&&c?!!t.__confetti_initialized:!1,M=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,v;function _(f,A,O){for(var T=N(f,"particleCount",i),q=N(f,"angle",Number),U=N(f,"spread",Number),F=N(f,"startVelocity",Number),ge=N(f,"decay",Number),ce=N(f,"gravity",Number),Ne=N(f,"drift",Number),Me=N(f,"colors",re),Ie=N(f,"ticks",Number),_e=N(f,"shapes"),pe=N(f,"scalar"),Se=!!N(f,"flat"),G=xe(f),Q=T,be=[],Pe=t.width*G.x,Re=t.height*G.y;Q--;)be.push(he({x:Pe,y:Re,angle:q,spread:U,startVelocity:F,color:Me[Q%Me.length],shape:_e[me(0,_e.length)],ticks:Ie,decay:ge,gravity:ce,drift:Ne,scalar:pe,flat:Se}));return v?v.addFettis(be):(v=B(t,be,x,A,O),v.promise)}function E(f){var A=m||N(f,"disableForReducedMotion",Boolean),O=N(f,"zIndex",Number);if(A&&M)return ee(function(F){F()});n&&v?t=v.canvas:n&&!t&&(t=P(O),document.body.appendChild(t)),d&&!p&&x(t);var T={width:t.width,height:t.height};c&&!p&&c.init(t),p=!0,c&&(t.__confetti_initialized=!0);function q(){if(c){var F={getBoundingClientRect:function(){if(!n)return t.getBoundingClientRect()}};x(F),c.postMessage({resize:{width:F.width,height:F.height}});return}T.width=T.height=null}function U(){v=null,d&&(u=!1,k.removeEventListener("resize",q)),n&&t&&(document.body.contains(t)&&document.body.removeChild(t),t=null,p=!1)}return d&&!u&&(u=!0,k.addEventListener("resize",q,!1)),c?c.fire(f,T,U):_(f,T,U)}return E.reset=function(){c&&c.reset(),v&&v.reset()},E}var fe;function ie(){return fe||(fe=J(null,{useWorker:!0,resize:!0})),fe}function Ee(t,e,n,d,u,m,h){var c=new Path2D(t),x=new Path2D;x.addPath(c,new DOMMatrix(e));var p=new Path2D;return p.addPath(x,new DOMMatrix([Math.cos(h)*u,Math.sin(h)*u,-Math.sin(h)*m,Math.cos(h)*m,n,d])),p}function le(t){if(!a)throw new Error("path confetti are not supported in this browser");var e,n;typeof t=="string"?e=t:(e=t.path,n=t.matrix);var d=new Path2D(e),u=document.createElement("canvas"),m=u.getContext("2d");if(!n){for(var h=1e3,c=h,x=h,p=0,M=0,v,_,E=0;E<h;E+=2)for(var f=0;f<h;f+=2)m.isPointInPath(d,E,f,"nonzero")&&(c=Math.min(c,E),x=Math.min(x,f),p=Math.max(p,E),M=Math.max(M,f));v=p-c,_=M-x;var A=10,O=Math.min(A/v,A/_);n=[O,0,0,O,-Math.round(v/2+c)*O,-Math.round(_/2+x)*O]}return{type:"path",path:e,matrix:n}}function V(t){var e,n=1,d="#000000",u='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof t=="string"?e=t:(e=t.text,n="scalar"in t?t.scalar:n,u="fontFamily"in t?t.fontFamily:u,d="color"in t?t.color:d);var m=10*n,h=""+m+"px "+u,c=new OffscreenCanvas(m,m),x=c.getContext("2d");x.font=h;var p=x.measureText(e),M=Math.ceil(p.actualBoundingBoxRight+p.actualBoundingBoxLeft),v=Math.ceil(p.actualBoundingBoxAscent+p.actualBoundingBoxDescent),_=2,E=p.actualBoundingBoxLeft+_,f=p.actualBoundingBoxAscent+_;M+=_+_,v+=_+_,c=new OffscreenCanvas(M,v),x=c.getContext("2d"),x.font=h,x.fillStyle=d,x.fillText(e,E,f);var A=1/n;return{type:"bitmap",bitmap:c.transferToImageBitmap(),matrix:[A,0,0,A,-M*A/2,-v*A/2]}}Z.exports=function(){return ie().apply(this,arguments)},Z.exports.reset=function(){ie().reset()},Z.exports.create=J,Z.exports.shapeFromPath=le,Z.exports.shapeFromText=V})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),Fe,!1);const it=Fe.exports;Fe.exports.create;const ft=()=>{const{id:$}=Je(),k=Ze(),{exams:Z,user:o,saveResult:ae,showAlert:z,t:a,results:de,startExamSession:ne,examSessions:ee,prizeExams:te,language:ue,systemSettings:we,updateUser:oe,watchAdForPoints:je}=He(),W=(o==null?void 0:o.role)===Ae.TEACHER?"/teacher":"/student",N=(o==null?void 0:o.role)===Ae.STUDENT,[i,me]=y.useState(null),[S,re]=y.useState(0),[Oe,xe]=y.useState(0),[D,H]=y.useState(0),[P,se]=y.useState(!1),[he,Y]=y.useState([]),[B,J]=y.useState([]),[fe,ie]=y.useState(!0),[Ee,le]=y.useState(null),[V,t]=y.useState(!1),[e,n]=y.useState(!1),[d,u]=y.useState(null),[m,h]=y.useState({}),[c,x]=y.useState(!1),[p,M]=y.useState(""),[v,_]=y.useState("GENERIC"),[E,f]=y.useState(!1),[A,O]=y.useState(null),[T,q]=y.useState(null),[U,F]=y.useState(!1),[ge,ce]=y.useState(10),Ne=y.useRef(null),Me=(s,l)=>{if(typeof window>"u")return l;const g=sessionStorage.getItem(`exam_time_${s}`),C=g?parseInt(g,10):NaN;return!isNaN(C)&&C>0?C:l},Ie=(s,l)=>{typeof window>"u"||sessionStorage.setItem(`exam_time_${s}`,String(l))},_e=s=>{typeof window>"u"||sessionStorage.removeItem(`exam_time_${s}`)},pe=(s,l="GENERIC")=>{M(s),_(l),x(!0)};y.useEffect(()=>{var R,ye;if(!o){k("/auth");return}const s=Z.find(X=>X.id===$);if(!s){me(null),ie(!1);return}const l=s.price>0,g=(R=o.purchasedExamIds)==null?void 0:R.includes(s.id),C=o.id===s.creatorId,I=o.role===Ae.ADMIN,j=te.find(X=>X.examId===s.id&&X.isActive);if(j&&!N){z(a("prize_students_only"),"warning"),k(W==="/teacher"?"/teacher/exams":"/student/prize-exams",{replace:!0});return}const L=(ye=j==null?void 0:j.participants)==null?void 0:ye.includes(o.id);if(l&&!g&&!C&&!I&&!L){me(s),f(!0),O(s.price),ie(!1),pe(a("insufficient_points_message").replace("{points}",`${s.price}`),"EXAM_ACCESS");return}f(!1),O(null),me(s);const b=Me(s.id,s.timeLimit);q(b),ce(b);const w=de.find(X=>X.examId===s.id&&X.studentId===o.id);w&&!e?(xe(w.score),se(!0),w.answers?J(w.answers):J(new Array(s.questions.length).fill(-1)),le(w.rewardsEarned),H(0)):($&&o&&ne($),J(new Array(s.questions.length).fill(-1)),le(null),H(b*60),se(!1)),ie(!1)},[$,Z,k,o,de,te,ne,a,e,z,W,N]),y.useEffect(()=>{if(i&&!P&&!V&&$&&o){const s=T??i.timeLimit,l=`${o.id}_${$}`,g=ee[l]||ee[$];if(g&&g.status==="started"&&g.startedAt){const C=Date.now(),I=new Date(g.startedAt).getTime(),j=Math.floor((C-I)/1e3),L=s*60-j;L<=0?H(0):H(L)}else H(s*60)}},[i,P,V,$,ee,o,T]),y.useEffect(()=>{if(D>0&&!P&&!V&&i){const s=setInterval(()=>{H(l=>Math.max(0,l-1))},1e3);return()=>clearInterval(s)}},[D,P,i,V]),y.useEffect(()=>{D===0&&i&&!P&&!V&&G()},[D,i,P,V]),y.useEffect(()=>{if(U){const s=requestAnimationFrame(()=>{var l;return(l=Ne.current)==null?void 0:l.focus()});return()=>cancelAnimationFrame(s)}},[U]);const Se=s=>{if(P||!i)return;if(D<=0){G();return}if(he.includes(s))return;const l=[...B];l[S]=s,J(l),S<i.questions.length-1&&setTimeout(()=>{re(g=>Math.min(i.questions.length-1,g+1)),Y([])},150)},G=s=>{if(!i||!o||P)return;const l=s?[...s]:[...B];se(!0),n(!1),J(l),_e(i.id),ae(i.id,l);const g=i.questions.reduce((j,L,K)=>j+(l[K]===L.correctIndex?1:0),0);xe(g),it({particleCount:150,spread:70,origin:{y:.6}});const C=i.difficulty==="Easy"?1:i.difficulty==="Medium"?1.5:2,I=Math.round(g*10*C);le(I)},Q=we.aiExplainCost||0,be=async s=>{if(!i||!o)return;const l=i.questions[s];u(l.id);let g=null;try{if(Q>0){if(o.points<Q){pe(a("insufficient_points_message").replace("{points}",`${Q}`),"EXPLAIN"),u(null);return}const I={...o,points:o.points-Q};oe(I),g=I,z(a("ai_explain_cost_success").replace("{points}",`${Q}`),"success")}const C=await Ge(l.text,l.options,l.correctIndex,B[s]===-1?null:B[s],ue);h(I=>({...I,[l.id]:C}))}catch(C){console.error(C),g&&oe({...g,points:g.points+Q}),z(C.message||"Unable to generate explanation.","error")}finally{u(null)}},Pe=()=>{if(!o||!i){z(a("no_joker"),"error");return}if(!o.inventory.includes("JOKER_5050")){z(a("no_joker"),"error");return}if(he.length>0)return;const s=we.joker5050Cost||0;if(s>0&&o.points<s){pe(a("insufficient_points_message").replace("{points}",`${s}`),"GENERIC");return}const l=i.questions[S],g=l.options.map((w,R)=>R).filter(w=>w!==l.correctIndex);if(g.length===0)return;let C=Math.min(2,Math.ceil(g.length/2));l.options.length===2&&(C=1);const I=[],j=[...g];for(let w=0;w<C&&j.length!==0;w++){const R=Math.floor(Math.random()*j.length);I.push(j[R]),j.splice(R,1)}Y(I);const L=[...o.inventory||[]],K=L.indexOf("JOKER_5050");K>-1&&L.splice(K,1);const b=s>0?o.points-s:o.points;oe({...o,inventory:L,points:b}),z(a("joker_5050_used"),"info")},Re=()=>{if(!o||!i){z(a("no_joker"),"error");return}if(!o.inventory.includes("JOKER_SKIP")){z(a("no_joker"),"error");return}z(a("joker_skip_used"),"info");const s=[...B];s[S]=-1,J(s);const l=[...o.inventory||[]],g=l.indexOf("JOKER_SKIP");g>-1&&l.splice(g,1),oe({...o,inventory:l}),S<i.questions.length-1?(re(C=>C+1),Y([])):G(s)};if(E&&i)return r.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-center px-6 text-gray-600",children:[r.jsx($e,{size:48,className:"mb-4 text-yellow-500"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:a("not_enough_points")}),r.jsx("p",{className:"max-w-md",children:a("insufficient_points_message").replace("{points}",`${A??i.price}`)}),r.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-sm mt-8",children:[r.jsx("button",{onClick:()=>je(),className:"bg-brand-100 text-brand-700 font-semibold rounded-2xl py-3 hover:bg-brand-200 transition-colors",children:a("watch_ad_cta")}),r.jsx("button",{onClick:()=>k(`${W}/shop`),className:"bg-gray-900 text-white font-semibold rounded-2xl py-3 hover:scale-[1.02] transition-transform",children:a("go_to_shop_cta")}),r.jsx("button",{onClick:()=>k(`${W}/exams`),className:"border border-gray-200 text-gray-600 font-semibold rounded-2xl py-3 hover:bg-gray-50 transition-colors",children:a("go_to_market")})]})]});if(fe)return r.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-gray-400",children:[r.jsx(Qe,{size:48,className:"animate-spin mb-4 text-brand-500"}),r.jsx("p",{className:"font-bold",children:a("loading_exam")})]});if(!i)return r.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-gray-400",children:[r.jsx($e,{size:48,className:"mb-4 text-red-400"}),r.jsx("p",{className:"font-bold",children:"Exam not found or access denied."}),r.jsx("button",{onClick:()=>k(W),className:"mt-4 text-brand-600 font-bold hover:underline",children:"Go Home"})]});const Ue=()=>{if(S!==0){if(D<=0&&!P){G();return}re(s=>Math.max(0,s-1)),Y([])}},De=()=>{if(!(!i||S>=i.questions.length-1)){if(D<=0&&!P){G();return}re(s=>s+1),Y([])}},Ke=()=>{i&&(ce(T??i.timeLimit),F(!0))},Le=()=>{if(!i||!$)return;const s=Math.max(1,ge);n(!0),Ie(i.id,s),q(s),ne($),se(!1),t(!1),re(0),Y([]),xe(0);const l=new Array(i.questions.length).fill(-1);J(l),h({}),H(s*60),le(null),F(!1)},ze=c?r.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-sm w-full space-y-4 shadow-2xl",children:[r.jsx("h3",{className:"text-xl font-bold text-gray-800",children:a("insufficient_points_title")}),r.jsx("span",{className:"text-[11px] font-bold uppercase tracking-widest text-gray-400",children:a(v==="EXPLAIN"?"ai_explain":"exam_details")}),r.jsx("p",{className:"text-gray-600",children:p}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("button",{onClick:()=>{je(),x(!1)},className:"w-full bg-brand-100 text-brand-700 font-semibold rounded-xl py-3 hover:bg-brand-200 transition-colors",children:a("watch_ad_cta")}),r.jsx("button",{onClick:()=>{x(!1),k(`${W}/shop`)},className:"w-full bg-gray-900 text-white font-semibold rounded-xl py-3 hover:scale-[1.02] transition-transform",children:a("go_to_shop_cta")}),r.jsx("button",{onClick:()=>x(!1),className:"w-full border border-gray-200 text-gray-600 font-semibold rounded-xl py-3 hover:bg-gray-50 transition-colors",children:a("close")})]})]})}):null;if(P){const s=i.questions.reduce((b,w,R)=>b+(B[R]===w.correctIndex?1:0),0),l=i.questions.reduce((b,w,R)=>b+(B[R]!==-1&&B[R]!==w.correctIndex?1:0),0),g=i.questions.length-s-l,C=Math.round(s/i.questions.length*100),I=Ee??Math.round(s*10*(i.difficulty==="Easy"?1:i.difficulty==="Medium"?1.5:2));if(V)return r.jsxs("div",{className:"max-w-3xl mx-auto p-4 md:p-8 space-y-6 pb-20",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[r.jsx("button",{onClick:()=>{t(!1),se(!1),k(N?"/student/results":`${W}/exams`)},className:"p-2 bg-gray-100 rounded-full hover:bg-gray-200",children:r.jsx(Te,{className:"rotate-180",size:20})}),r.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:a("review_answers")})]}),i.questions.map((b,w)=>{const R=B[w],ye=R===b.correctIndex,X=!!m[b.id],Be=d===b.id;return r.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-sm border border-gray-100 relative overflow-hidden",children:[r.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-2 ${ye?"bg-green-500":"bg-red-500"}`}),r.jsxs("h3",{className:"font-bold text-gray-900 mb-4 pl-4",children:[w+1,". ",b.text]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4 pl-4",children:[r.jsxs("div",{className:`p-3 rounded-xl text-sm font-bold border ${ye?"bg-green-50 border-green-200 text-green-700":"bg-red-50 border-red-200 text-red-700"}`,children:[r.jsx("span",{className:"block text-xs uppercase opacity-70 mb-1",children:a("your_answer")}),R!==-1&&R!==void 0?b.options[R]:a("skip")]}),r.jsxs("div",{className:"p-3 rounded-xl text-sm font-bold bg-blue-50 border border-blue-200 text-blue-700",children:[r.jsx("span",{className:"block text-xs uppercase opacity-70 mb-1",children:a("correct_answer")}),b.options[b.correctIndex]]})]}),r.jsx("div",{className:"pl-4",children:X?r.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl border border-purple-100 text-purple-800 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 font-bold mb-2",children:[r.jsx(qe,{size:16})," AI Explanation"]}),m[b.id]]}):r.jsx("button",{onClick:()=>be(w),disabled:Be,className:"flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-xl text-sm font-bold hover:scale-105 transition-transform disabled:opacity-50",children:Be?a("explaining"):r.jsxs(r.Fragment,{children:[r.jsx(qe,{size:16})," ",a("ai_explain")]})})})]},b.id)})]});const j=o?de.find(b=>b.examId===i.id&&b.studentId===o.id):null,L=j==null?void 0:j.learningReportStatus,K=j==null?void 0:j.learningReport;return r.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-6",children:[r.jsx("div",{className:"text-6xl mb-4 animate-bounce",children:C>70?"ðŸŽ‰":"ðŸ‘"}),r.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:a("exam_completed")}),r.jsxs("p",{className:"text-gray-500 mb-8",children:[a("you_scored")," ",s," / ",i.questions.length]}),r.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-lg w-full max-w-sm border border-gray-100 mb-8",children:[r.jsxs("div",{className:"text-4xl font-black text-brand-500 mb-1",children:["+",I]}),r.jsx("div",{className:"text-sm font-bold text-gray-400 uppercase tracking-wider",children:a("points_earned")})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-3 w-full max-w-sm mb-8",children:[r.jsxs("div",{className:"bg-green-50 border border-green-100 rounded-2xl p-3",children:[r.jsx("p",{className:"text-xs font-semibold text-green-600 uppercase",children:a("correct_count")}),r.jsx("p",{className:"text-2xl font-bold text-green-700",children:s})]}),r.jsxs("div",{className:"bg-red-50 border border-red-100 rounded-2xl p-3",children:[r.jsx("p",{className:"text-xs font-semibold text-red-600 uppercase",children:a("wrong_count")}),r.jsx("p",{className:"text-2xl font-bold text-red-700",children:l})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-2xl p-3",children:[r.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase",children:a("blank_count")}),r.jsx("p",{className:"text-2xl font-bold text-gray-700",children:g})]})]}),j&&r.jsxs("div",{className:"w-full max-w-lg bg-white/80 backdrop-blur border border-gray-100 rounded-3xl p-5 text-left mb-8 space-y-3 shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:a("learning_outcomes_title")}),r.jsx("span",{className:"text-[10px] font-bold text-gray-400",children:new Date(j.date).toLocaleDateString()})]}),L==="pending"&&r.jsx("p",{className:"text-sm text-gray-500",children:a("learning_outcomes_pending")}),L==="failed"&&r.jsx("p",{className:"text-sm text-red-500",children:a("learning_outcomes_error")}),L==="ready"&&K&&r.jsxs(r.Fragment,{children:[r.jsx("p",{className:"text-sm text-gray-700",children:K.summary}),r.jsx("ul",{className:"space-y-2",children:K.outcomes.map((b,w)=>r.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-800",children:[r.jsx("span",{className:"text-brand-500 mt-1",children:"â€¢"}),r.jsx("span",{children:b})]},`outcome-${w}`))}),K.focusAreas.length>0&&r.jsxs("div",{className:"pt-2 border-t border-gray-100",children:[r.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase mb-2",children:a("learning_outcomes_focus_title")}),r.jsx("ul",{className:"space-y-2",children:K.focusAreas.map((b,w)=>r.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600",children:[r.jsx("span",{className:"text-gray-400 mt-1",children:"â†’"}),r.jsx("span",{children:b})]},`focus-${w}`))})]})]})]}),r.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-sm",children:[r.jsxs("button",{onClick:Ke,className:"bg-emerald-100 text-emerald-700 px-8 py-3 rounded-2xl font-bold hover:bg-emerald-200 transition-colors flex items-center justify-center gap-2",children:[r.jsx(Te,{size:20})," ",a("retake")]}),r.jsxs("button",{onClick:()=>t(!0),className:"bg-purple-100 text-purple-700 px-8 py-3 rounded-2xl font-bold hover:bg-purple-200 transition-colors flex items-center justify-center gap-2",children:[r.jsx(Ve,{size:20})," ",a("review_answers")]}),r.jsx("button",{onClick:()=>k(W),className:"bg-gray-900 text-white px-8 py-3 rounded-2xl font-bold hover:scale-105 transition-transform",children:a("back_dashboard")})]}),U&&i&&r.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-sm w-full shadow-2xl space-y-4",children:[r.jsx("h3",{className:"text-xl font-bold text-gray-800",children:a("retake_exam")}),r.jsx("p",{className:"text-sm text-gray-500",children:a("time_min")}),r.jsx("input",{type:"number",min:1,value:ge,ref:Ne,onChange:b=>{const w=Number(b.target.value);ce(Math.max(1,isNaN(w)?1:w))},className:"w-full bg-gray-50 border border-gray-200 rounded-2xl p-4 text-center text-3xl font-black text-gray-800"}),r.jsxs("div",{className:"flex gap-3 pt-2",children:[r.jsx("button",{onClick:()=>F(!1),className:"flex-1 border border-gray-200 rounded-2xl py-3 font-semibold text-gray-600 hover:bg-gray-50 transition-colors",children:a("cancel")}),r.jsx("button",{onClick:Le,className:"flex-1 bg-brand-500 text-white rounded-2xl py-3 font-semibold hover:bg-brand-600 transition-colors",children:a("start")})]})]})}),ze]})}const ke=!te.find(s=>s.examId===i.id&&s.isActive),ve=i.questions[S],We=S/i.questions.length*100;return r.jsxs("div",{className:"max-w-3xl mx-auto h-[calc(100vh-120px)] flex flex-col",children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-xl shadow-sm",children:[r.jsx(Xe,{size:18,className:"text-brand-500"}),r.jsxs("span",{className:"font-mono font-bold text-gray-700",children:[Math.floor(D/60),":",String(D%60).padStart(2,"0")]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:Pe,disabled:!ke||!(o!=null&&o.inventory.includes("JOKER_5050")),className:`p-2 rounded-xl border-2 transition-all ${ke&&(o!=null&&o.inventory.includes("JOKER_5050"))?"border-purple-200 bg-purple-50 text-purple-600 hover:scale-105":"border-gray-100 bg-gray-50 text-gray-300 cursor-not-allowed opacity-60"}`,title:"50/50",children:r.jsxs("div",{className:"font-bold text-xs flex items-center gap-1",children:[r.jsx(Ye,{size:14})," 50%"]})}),r.jsx("button",{onClick:Re,disabled:!ke||!(o!=null&&o.inventory.includes("JOKER_SKIP")),className:`p-2 rounded-xl border-2 transition-all ${ke&&(o!=null&&o.inventory.includes("JOKER_SKIP"))?"border-blue-200 bg-blue-50 text-blue-600 hover:scale-105":"border-gray-100 bg-gray-50 text-gray-300 cursor-not-allowed opacity-60"}`,title:"Skip",children:r.jsxs("div",{className:"font-bold text-xs flex items-center gap-1",children:[r.jsx(Te,{size:14})," ",a("skip")]})})]})]}),r.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full mb-8 overflow-hidden",children:r.jsx("div",{className:"h-full bg-brand-500 transition-all duration-500",style:{width:`${We}%`}})}),r.jsxs("div",{className:"bg-white p-6 md:p-8 rounded-[2rem] shadow-xl flex-1 relative overflow-hidden flex flex-col",children:[r.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-brand-300 to-brand-500 z-10"}),r.jsx("div",{className:"overflow-y-auto custom-scrollbar flex-1 -mx-4 px-4 md:-mx-6 md:px-6",children:r.jsxs("div",{className:"min-h-full flex flex-col justify-center py-6",children:[r.jsx("h3",{className:"text-2xl md:text-3xl font-bold text-gray-900 mb-8 leading-tight",children:ve.text}),ve.imageUrl&&r.jsx("div",{className:"w-full max-h-60 bg-white border border-gray-100 rounded-2xl mb-6 flex items-center justify-center p-4 overflow-hidden",children:r.jsx("img",{src:ve.imageUrl,className:"max-h-52 w-auto object-contain",alt:a("question")})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ve.options.map((s,l)=>{var j;if(he.includes(l))return null;const g=(j=ve.optionImages)==null?void 0:j[l],C=B[S]===l;let I="border-2 border-gray-100 hover:border-brand-300 hover:bg-brand-50 text-gray-800";return C&&(I="border-brand-500 bg-brand-50 text-brand-700 shadow-brand-100"),r.jsx("button",{onClick:()=>Se(l),disabled:P,className:`w-full text-left p-4 rounded-xl font-medium transition-all text-lg flex flex-col md:flex-row md:items-center justify-between gap-3 ${I}`,children:r.jsxs("div",{className:"flex items-center gap-3 w-full",children:[g&&r.jsx("img",{src:g,className:"w-16 h-16 rounded-lg object-cover border border-gray-200"}),r.jsx("span",{className:"flex-1 break-words whitespace-normal text-gray-800",children:s})]})},l)})}),r.jsxs("div",{className:"mt-8 flex flex-col md:flex-row gap-3",children:[S>0&&r.jsxs("button",{onClick:Ue,disabled:P,className:"flex-1 flex items-center justify-center gap-2 border border-gray-200 rounded-xl py-3 font-semibold text-gray-600 hover:bg-gray-50 disabled:opacity-50",children:[r.jsx(tt,{size:18})," ",a("previous_question")]}),r.jsxs("button",{onClick:De,disabled:S===i.questions.length-1||P,className:"flex-1 flex items-center justify-center gap-2 border border-gray-200 rounded-xl py-3 font-semibold text-gray-600 hover:bg-gray-50 disabled:opacity-50",children:[a("next_question")," ",r.jsx(st,{size:18})]}),r.jsxs("button",{onClick:()=>G(),disabled:P,className:"flex-1 flex items-center justify-center gap-2 bg-brand-500 text-white rounded-xl py-3 font-semibold hover:bg-brand-600 disabled:opacity-50",children:[r.jsx(nt,{size:18})," ",a("finish_exam")]})]})]})})]}),r.jsxs("div",{className:"mt-6 text-center text-gray-400 font-medium text-sm",children:[a("question")," ",S+1," ",a("of")," ",i.questions.length," â€¢ ",a("answered"),": ",B.filter(s=>s!==-1).length]}),ze,U&&i&&r.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-sm w-full shadow-2xl space-y-4",children:[r.jsx("h3",{className:"text-xl font-bold text-gray-800",children:a("retake_exam")}),r.jsx("p",{className:"text-sm text-gray-500",children:a("time_min")}),r.jsx("input",{type:"number",min:1,value:ge,onChange:s=>{const l=Number(s.target.value);ce(Math.max(1,isNaN(l)?1:l))},className:"w-full bg-gray-50 border border-gray-200 rounded-2xl p-4 text-center text-3xl font-black text-gray-800"}),r.jsxs("div",{className:"flex gap-3 pt-2",children:[r.jsx("button",{onClick:()=>F(!1),className:"flex-1 border border-gray-200 rounded-2xl py-3 font-semibold text-gray-600 hover:bg-gray-50 transition-colors",children:a("cancel")}),r.jsx("button",{onClick:Le,className:"flex-1 bg-brand-500 text-white rounded-2xl py-3 font-semibold hover:bg-brand-600 transition-colors",children:a("retake")})]})]})})]})};export{ft as ExamRoom};
