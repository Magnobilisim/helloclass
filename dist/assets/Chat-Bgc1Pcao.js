import{u as C,r as d,a as T,j as e,M as k}from"./index-0u4Oh89o.js";import{S as L}from"./search-D0VNxm3I.js";import{A as I}from"./arrow-left-D4zpq9zv.js";import{S as M}from"./send-yfrFOzgJ.js";const E=()=>{const{user:r,users:x,messages:m,sendMessage:p,markMessageRead:u,t:o}=C(),[s,h]=d.useState(null),[l,g]=d.useState(""),[b,y]=d.useState(""),i=d.useRef(null),c=T();d.useEffect(()=>{if(c.state&&c.state.startChatWith){const t=c.state.startChatWith,a=x.find(n=>n.id===t);a&&(h(a),window.history.replaceState({},document.title))}},[c.state,x]);const j=(t="auto")=>{i.current&&i.current.scrollTo({top:i.current.scrollHeight,behavior:t})};d.useLayoutEffect(()=>{j("auto"),s&&u(s.id)},[m,s]);const f=()=>{!s||!l.trim()||(p(s.id,l),g(""))},w=x.filter(t=>t.id!==(r==null?void 0:r.id)&&t.name.toLowerCase().includes(b.toLowerCase())&&!t.isBanned),v=m.filter(t=>t.senderId===(r==null?void 0:r.id)&&t.receiverId===(s==null?void 0:s.id)||t.senderId===(s==null?void 0:s.id)&&t.receiverId===(r==null?void 0:r.id)).sort((t,a)=>new Date(t.timestamp).getTime()-new Date(a.timestamp).getTime());return e.jsxs("div",{className:"flex h-[calc(100dvh-130px)] md:h-[calc(100vh-100px)] bg-white rounded-3xl shadow-sm border border-gray-200 overflow-hidden relative z-0",children:[e.jsxs("div",{className:`w-full md:w-80 bg-gray-50 border-r border-gray-100 flex flex-col ${s?"hidden md:flex":"flex"}`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-3",children:o("messages")}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-2.5 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search...",value:b,onChange:t=>y(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-white rounded-xl border border-gray-200 focus:outline-none focus:border-brand-400 text-sm text-gray-900"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:w.map(t=>{const a=m.filter(n=>n.senderId===t.id&&n.receiverId===(r==null?void 0:r.id)&&!n.isRead).length;return e.jsxs("div",{onClick:()=>h(t),className:`flex items-center gap-3 p-4 cursor-pointer hover:bg-white transition-colors border-b border-gray-50 ${(s==null?void 0:s.id)===t.id?"bg-white border-l-4 border-l-brand-500 shadow-sm":""}`,children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-12 h-12 rounded-full border border-gray-200 shrink-0 object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:`font-bold truncate text-sm ${(s==null?void 0:s.id)===t.id?"text-brand-700":"text-gray-800"}`,children:t.name}),a>0&&e.jsx("span",{className:"bg-red-500 text-white text-[10px] px-1.5 py-0.5 rounded-full font-bold shadow-sm",children:a})]}),e.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold mt-0.5",children:o(t.role.toLowerCase())})]})]},t.id)})})]}),e.jsx("div",{className:`flex-1 flex flex-col bg-white min-w-0 ${s?"flex":"hidden md:flex"}`,children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 md:p-4 border-b border-gray-100 flex items-center gap-3 bg-white shadow-sm z-10 shrink-0",children:[e.jsx("button",{onClick:()=>h(null),className:"md:hidden p-2 -ml-2 text-gray-500 hover:text-gray-900 bg-gray-50 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(I,{size:20})}),e.jsx("img",{src:s.avatar,className:"w-10 h-10 rounded-full border border-gray-100 object-cover"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800 text-sm md:text-base",children:s.name}),e.jsx("span",{className:"text-xs text-green-500 font-bold flex items-center gap-1",children:"● Online"})]})]}),e.jsx("div",{ref:i,className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50/30 scroll-smooth custom-scrollbar",children:v.map(t=>{const a=t.senderId===(r==null?void 0:r.id),n=new Date(t.timestamp),N=n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),S=n.toLocaleDateString();return e.jsx("div",{className:`flex ${a?"justify-end":"justify-start"} animate-fade-in`,children:e.jsxs("div",{className:`max-w-[85%] md:max-w-[70%] p-3 rounded-2xl text-sm leading-relaxed shadow-sm ${a?"bg-brand-500 text-white rounded-br-none":"bg-white text-gray-700 rounded-bl-none border border-gray-200"}`,children:[e.jsx("p",{children:t.content}),e.jsxs("div",{className:`flex items-center justify-end gap-1 mt-1 text-[10px] ${a?"text-brand-100":"text-gray-400"}`,children:[e.jsx("span",{children:S}),e.jsx("span",{children:"•"}),e.jsx("span",{children:N}),a&&e.jsx("span",{className:"opacity-80 font-bold",children:t.isRead?"✓✓":"✓"})]})]})},t.id)})}),e.jsx("div",{className:"p-3 md:p-4 bg-white border-t border-gray-100 shrink-0 pb-safe",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:t=>g(t.target.value),onKeyDown:t=>t.key==="Enter"&&f(),placeholder:o("type_message"),className:"flex-1 bg-gray-100 border-0 rounded-xl px-4 py-3 focus:ring-2 focus:ring-brand-500 focus:bg-white transition-all text-gray-900 placeholder-gray-500 font-medium"}),e.jsx("button",{onClick:f,disabled:!l.trim(),className:"bg-brand-500 text-white p-3 rounded-xl hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-brand-200 active:scale-95",children:e.jsx(M,{size:20})})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400 p-8 bg-gray-50/30",children:[e.jsx("div",{className:"w-20 h-20 bg-white rounded-full flex items-center justify-center mb-4 shadow-sm border border-gray-100",children:e.jsx(k,{size:40,className:"text-gray-300"})}),e.jsxs("p",{className:"text-lg font-bold text-gray-600",children:[o("chat_with")," someone!"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-2 text-center max-w-xs",children:"Select a contact from the left to start a conversation."})]})})]})};export{E as Chat};
